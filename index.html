<!DOCTYPE html>


<html ng-app="app">
<head>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <style>
        .navbar { border-radius:0; }
    </style>
<script src="//code.angularjs.org/1.2.13/angular.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.8/angular-ui-router.min.js"></script>
 
 <script src="javascripts/app.js"></script>  
</head>



<body >


<!--<div class="container">-->
<!--</div>-->


<h2> Channels </h2>

Channels is the new concept in Django framework .Django is synchronous and Channels provide asynchronous request by websockets .
channels are mostly used as cron jobs and building a chat application


<h3>consumers</h3>
Channels works on redis server which is in-memory. Channels work as message broker which all messages are stored in Queue(first in first out).
 there are consumers and workers . messages are add to AsgiHandler and connect to the other ends and broadcast the message. 



<h4>Groups</h4>
Groups are the core concept of channels . Group provide multi-cast messaging.
Instead of echoing the message back to the client like we did above, we’ll instead send it to the whole Group,
which means any client who’s been added to it will get the message.



<h4>Lets code</h4>

<h5>Installation</h5>

<p><code>pip install -U channels</code></p>

After installing channels , add channels app in your settings file.


<p>
<code>Installed_apps={</code></p>
<p><code> app , </code></p>
<p><code> channels, </code></p>
<p><code>}</code></p>

<p>And now add a below code in app/consumers.py .</p>
<!--<img src="">-->



<code>from channels import Channel</code>
<p><code>from channels import Group </code></p>


<p><code>def ws_add(message):</code></p>
	
<p><code>&nbsp;&nbsp;&nbsp;&nbsp;Group("chat").add(message.reply_channel)</code></p>



create new routing file in the same folder where settings file . 
It is same as urls.py in django app.

<p><code>from channels.routing import route</code></p>
<p><code>from chat.consumers import ws_add</code></p>

</p><code>channel_routing = [ </code></p>
				<p></code>route("websocket.connect", ws_add),</code> </p>
				<p><code>]</code></p>



And last add channel_layer code in settings.py

<pre>
CHANNEL_LAYERS = {
    "default": {
        "BACKEND": "asgiref.inmemory.ChannelLayer",
        "ROUTING": "myproject.routing.channel_routing",
    },
}
</pre>


And now go to your terminal and run your server <pre>python manage.py runserver </pre>
Go to browser console .
and write some javascript/html5 to test your app.


<pre>socket= new WebSocket("ws://"+ window.location.host+"/room1");</pre>
<pre>socket.onmessage = function(response){console.log(response.data)};</pre>
<pre>socket.send('hi!!');</pre>

and open another browser instance and do same as above and u can see the messages are broadcast on both browsers .




 




</body>


</html>

